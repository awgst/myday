$(document).ready(function(){var page=1;editOrDelete('item');loadItem();$(document).on('dblclick','.item .form-search',function(){if($('#formNewItem').length===0){$(this).find('.form-item').prop('disabled',false);$(this).find('.form-item').focus()}});$(document).on('click','#editItem',function(){updateItem($(this).parent().find('.form-item'))});$(document).on('click','.item',function(){if(!($(this).hasClass('new-item')||$(this).hasClass('active'))){loadContent($(this))}});$(document).on('submit','#formNewItem',function(e){e.preventDefault();createItem($(this))})});function loadContent(param){if(param){$('#contentContainer').attr('style','height: 100%; align-items: center; display: flex; justify-content: center;');$('#contentContainer').html('<i class="fa fa-spinner fa-pulse text-muted" style="font-size: 30px;"></i>');$('.item.active.extra-light-blue').removeClass('active extra-light-blue');$('.form-item.active.extra-light-blue').removeClass('active extra-light-blue');param.addClass('active extra-light-blue');param.find('.form-item').addClass('active extra-light-blue');$.ajax({type:"GET",url:param.attr('data-url'),success:function(response){$('#contentContainer').removeAttr('style');$('#contentContainer').html(response);$('.form-date-card').trigger('change',true);$('.form-date-card').datepicker({format:'dd M yyyy',autoclose:true});$('.card').each(function(){updateProgressCompletion($(this))});$(window).trigger('resize');if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){$(function(){$(".tasks").sortable({items:'.task:not(#new-task)',stop:function(event,ui){let order=[];let index=1;$('.task:not(#new-task)').each(function(){order[index]=parseInt($(this).attr('data-id'));index+=1});updateOrder(order,orderingTaskRoute)}});$("#hidden-drag-ghost-list").sortable({stop:function(event,ui){let order=[];let index=1;$('.card').each(function(){order[index]=parseInt($(this).attr('data-id'));index+=1});updateOrder(order,orderingCardRoute)}});$(".items").sortable({stop:function(event,ui){let order=[];let index=1;$('.item').each(function(){order[index]=parseInt($(this).attr('data-id'));index+=1});updateOrder(order,orderingItemRoute)}})})}$('.form-item').each(function(){let width;if($(this).val().length>0){width=(($(this).val().length+1)*8)+'px'}else{width=(($(this).attr('placeholder').length+1)*8)+'px'}$(this).attr('style','width:'+width)})},error:function(response){toastr["error"](response.responseJSON.message,"ERROR")}})}else{$('#contentContainer').html('')}}function createItem(param){let items=$(param).parents('.form-new-item');let input=items.find('input');let saveIcon=$('#saveNewItem').find('i');onLoading(saveIcon,'fa-check');$('#saveNewItem').addClass('disabled');$.ajax({type:"POST",url:storeItemRoute,data:{name:input.val()},headers:{'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')},success:function(response){$(response).insertBefore($('.new-item'));$('.item').fadeIn();input.val('');onCreating()},error:function(response){toastr["error"](response.responseJSON.message,"ERROR")},complete:function(){afterLoading(saveIcon,'fa-check');$('#saveNewItem').removeClass('disabled')}})}function loadItem(page){$.ajax({type:"GET",url:listItemRoute,success:function(response){$('.item-loading').remove();$('.items').prepend(response);if(response==''){loadContent(null)}else{loadContent($('.item.active'))}},error:function(response){toastr["error"](response.responseJSON.message,"ERROR")}})}function updateItem(param){let input=param;let editItem=param.parents('.item').find('#editItem');onLoading(editItem.find('i'),'fa-save');$.ajax({type:"PUT",url:param.attr('data-url'),data:{name:param.val()},dataType:"json",headers:{'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')},success:function(response){input.val(response.item.name);loadContent(param.parents('.item'))},error:function(response){input.val('');toastr["error"](response.responseJSON.message,"ERROR")},complete:function(){input.blur();input.prop('disabled',true);editItem.attr('style','display:none;');param.parents('.item').find(`.count`).fadeIn();param.parents('.item').find(`#deleteItem`).fadeIn();afterLoading(editItem.find('i'),'fa-save')}})}function deleteItem(param){let icon=$(param).find('i');onLoading(icon,'fa-trash');$.ajax({type:"DELETE",url:$(param).attr('data-url'),headers:{'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')},success:function(response){$(param).parents('.item').remove();loadContent(null)},error:function(response){toastr["error"](response.responseJSON.message,"ERROR")},complete:function(){afterLoading(icon,'fa-trash')}})}function cancelNewItem(e){let parent=$(e).parents('.form-new-item');parent.html('');parent.append(`<a onclick="createNewItem(this)" class="new light-blue" style="cursor: pointer; display: none;"><i class="fa fa-plus light-blue"></i><span class="ms-1" style="font-weight: 300; font-size: 16px;">New List</span></a>`);$('a.new').fadeIn();cancelCreating()}function createNewItem(e){$(e).attr('style','display:none;');$(e).parent().append(`<div class="form-new-item form-search" style="display:none;"><form action="" class="d-flex justify-content-between align-items-center" id="formNewItem"> <input autofocus type="text" placeholder="New List" class="text-muted glass-input" style="line-height:1.75rem;" title="Press enter to create new item"> <div class="d-flex"> <a onclick="cancelNewItem(this)" id="cancelNewItem" class="btn btn-danger" style="padding: 0.1rem 0.15rem;line-height: 0;margin-left: 0.35rem;font-size: 12px;cursor:pointer;" title="Cancel"> <i class="fa fa-close" style="color: white;"></i> </a> <a id="saveNewItem" onclick="createItem(this)" class="btn btn-success" style="padding: 0.12rem 0.12rem; line-height: 0; margin-left: 0.25rem; font-size: 12px; cursor: pointer;" title="Save"><i class="fa fa-check" style="color: white;"></i></a></div></form></div>`);$(e).remove();$('.form-new-item').fadeIn();onCreating()}function onCreating(){$('.count').addClass('d-none');$('.deletion-item').removeClass('d-none')}function cancelCreating(){$('.deletion-item').addClass('d-none');$('.count').removeClass('d-none')}function updateOrder(data,route){$.ajax({type:"PUT",url:route,data:{data:data},headers:{'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')},success:function(response){},error:function(response){toastr["error"](response.responseJSON.message,"ERROR")}})}